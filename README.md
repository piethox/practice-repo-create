# David 3.12 - Practice CICD with Serverless - Node.js and lambda

## Steps
1. Create new repository, then clone to your local. 
2. Run “npm init” inside the new repo folder
New files will be created (package.json and package-lock.json)
- package.json : contains descriptive and functional metadata about a project, such as a name, version and dependencies
- package-lock.json : automatically generated by npm when a package is installed, including its sub-dependencies and versions.
3. Create .gitignore and ensure to put “node_modules/” and “.serverless” are inside
4. Push new files to github repo
5. Install serverless using “npm install serverless”
6. Install serverless offline using “npm install serverless-offline –save-dev”
7. push all changes git add 
8. Copy code from :
https://github.com/su-ntu-ctp/6m-cloud-3.6-cloud-native-application-serverless-i/blob/main/aws-node-http-api-project/index.js
to new file named index.js
9. copy code from:
https://github.com/su-ntu-ctp/6m-cloud-3.6-cloud-native-application-serverless-i/blob/main/aws-node-http-api-project/serverless.yml
to new file named serverless.yml
10. Update line 2 on serverless.yml to own project name
11. run locally for testing with command: serverless offline start

12. create index.test.js file with below contents :
```js
const { handler } = require('./index');

describe('Lambda Handler', () => {
  it('returns a successful response', async () => {
    const event = { key: 'value' };
    const expectedResponse = {
      statusCode: 200,
      body: JSON.stringify(
        {
          message: "Go Serverless v3.0! Your function executed successfully!",
          input: event,
        },
        null,
        2
      ),
    };
    const response = await handler(event);
    expect(response).toEqual(expectedResponse);
  });
});
```

13. Add AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY on github “Secrets and variables”
14. Create github action workflow for CICD inside .github/workflows/main.yml file with following flows :
- run when push action on any branches
- install-dependencies : github actions & npm install
- unit-testing : github actions, npm install & npm test
- deploy-serverless : github actions, use node.js, npm ci, serverless deploy with AWS Secret Key attributes
15. push to github repo and check on github actions tab
